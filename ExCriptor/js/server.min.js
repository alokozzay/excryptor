const rp=require("request-promise"),express=require("express");let key="23d14b58-5d96-453a-8714-25aa881e31cd";const main=3002,all=3004,coinData=3006,btc=3008,eth=3010,ltc=3012,rand=3016,cors=require("cors"),appTable=express(),appAll=express(),appDataCoins=express(),appBtc=express(),appEth=express(),appLtc=express(),appPar=express(),randCount=express();let tableData,allData,coinsData,btcData,ethData,ltcData,randPar,godexMas,allJoinedMas=[],tableJoinedMas=[],btcJoinedMas=[],ethJoinedMas=[],ltcJoinedMas=[],a1=0,a2=0,a3=0,a4=0,a5=0,c=0,corsOptions={origin:"http://80.78.241.227",optionsSuccessStatus:200};function tableDataGet(){rp({method:"GET",uri:"https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=1&limit=15&convert=USD",headers:{"X-CMC_PRO_API_KEY":key},json:!0,gzip:!0}).then(a=>{tableData=a,a1++}).catch(a=>{console.log("API call error:",a.message)})}function allDataGet(){rp({method:"GET",uri:"https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=1&limit=1000&convert=USD",headers:{"X-CMC_PRO_API_KEY":"23d14b58-5d96-453a-8714-25aa881e31cd"},json:!0,gzip:!0}).then(a=>{allData=a,a2++}).catch(a=>{console.log("API call error:",a.message)})}function coinsDataGet(){rp({method:"GET",uri:"https://pro-api.coinmarketcap.com/v1/cryptocurrency/quotes/latest?symbol=BTC,ETH,LTC",headers:{"X-CMC_PRO_API_KEY":key},json:!0,gzip:!0}).then(a=>{coinsData=a}).catch(a=>{console.log("API call error:",a.message)})}function btcDataGet(){rp({method:"GET",uri:"https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=1&limit=500&convert=BTC",headers:{"X-CMC_PRO_API_KEY":key},json:!0,gzip:!0}).then(a=>{btcData=a,a3++}).catch(a=>{console.log("API call error:",a.message)})}function ethDataGet(){rp({method:"GET",uri:"https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=1&limit=500&convert=ETH",headers:{"X-CMC_PRO_API_KEY":key},json:!0,gzip:!0}).then(a=>{ethData=a,a4++}).catch(a=>{console.log("API call error:",a.message)})}function ltcDataGet(){rp({method:"GET",uri:"https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?start=1&limit=500&convert=LTC",headers:{"X-CMC_PRO_API_KEY":key},json:!0,gzip:!0}).then(a=>{ltcData=a,a5++}).catch(a=>{console.log("API call error:",a.message)})}function godexData(){rp({async:!0,crossDomain:!0,url:"http://api.godex.io/api/v1/coins",method:"GET",headers:{accept:"application/json"}}).then(a=>{godexMas=JSON.parse(a),a1++,a2++,a3++,a4++,a5++,c++}).catch(a=>{console.log("API call error godexData:",a.message)})}function randFunc(){let a=getRandomNum(5,15).toFixed(1),e=getRandomNum(30,getRandomNum(10,60-a)).toFixed(1),t=getRandomNum(500,3500).toFixed(0);randPar=[a,e,t]}function tableMasJoin(){for(let a=0;a<godexMas.length;a++)for(let e=0;e<tableData.data.length;e++)if(godexMas[a].code.toLowerCase()==tableData.data[e].symbol.toLowerCase()){let t={code:godexMas[a].code,name:godexMas[a].name,icon:godexMas[a].icon,slug:tableData.data[e].slug,price:tableData.data[e].quote.USD.price,percent_change_24h:tableData.data[e].quote.USD.percent_change_24h,volume_24h:tableData.data[e].quote.USD.volume_24h};tableJoinedMas.push(t)}}function allMasJoin(){for(let a=0;a<godexMas.length;a++)for(let e=0;e<allData.data.length;e++)if(godexMas[a].code.toLowerCase()==allData.data[e].symbol.toLowerCase()){let t={code:godexMas[a].code,name:godexMas[a].name,icon:godexMas[a].icon,slug:allData.data[e].slug,price:allData.data[e].quote.USD.price,percent_change_24h:allData.data[e].quote.USD.percent_change_24h,volume_24h:allData.data[e].quote.USD.volume_24h};allJoinedMas.push(t)}}function btcMasJoin(){for(let a=0;a<godexMas.length;a++)for(let e=0;e<btcData.data.length;e++)if(godexMas[a].code.toLowerCase()==btcData.data[e].symbol.toLowerCase()){let t={code:godexMas[a].code,name:godexMas[a].name,icon:godexMas[a].icon,slug:btcData.data[e].slug,price:btcData.data[e].quote.BTC.price,percent_change_24h:btcData.data[e].quote.BTC.percent_change_24h,volume_24h:btcData.data[e].quote.BTC.volume_24h};btcJoinedMas.push(t)}}function ethMasJoin(){for(let a=0;a<godexMas.length;a++)for(let e=0;e<ethData.data.length;e++)if(godexMas[a].code.toLowerCase()==ethData.data[e].symbol.toLowerCase()){let t={code:godexMas[a].code,name:godexMas[a].name,icon:godexMas[a].icon,slug:ethData.data[e].slug,price:ethData.data[e].quote.ETH.price,percent_change_24h:ethData.data[e].quote.ETH.percent_change_24h,volume_24h:ethData.data[e].quote.ETH.volume_24h};ethJoinedMas.push(t)}}function ltcMasJoin(){for(let a=0;a<godexMas.length;a++)for(let e=0;e<ltcData.data.length;e++)if(godexMas[a].code.toLowerCase()==ltcData.data[e].symbol.toLowerCase()){let t={code:godexMas[a].code,name:godexMas[a].name,icon:godexMas[a].icon,slug:ltcData.data[e].slug,price:ltcData.data[e].quote.LTC.price,percent_change_24h:ltcData.data[e].quote.LTC.percent_change_24h,volume_24h:ltcData.data[e].quote.LTC.volume_24h};ltcJoinedMas.push(t)}}function getRandomNum(a,e){return Math.random()*(e-a)+a}setInterval(()=>{1===c&&(2===a1&&(tableMasJoin(),a1=0),2===a2&&(allMasJoin(),a2=0),2===a3&&(btcMasJoin(),a3=0),2===a4&&(ethMasJoin(),a4=0),2===a5&&(ltcMasJoin(),a5=0))},200),appTable.use(cors(corsOptions)),appTable.use((a,e)=>{e.json(tableJoinedMas)}),appAll.use(cors(corsOptions)),appAll.use((a,e)=>{e.json(allJoinedMas)}),appDataCoins.use(cors(corsOptions)),appDataCoins.use((a,e)=>{e.json(coinsData)}),appBtc.use(cors(corsOptions)),appBtc.use((a,e)=>{e.json(btcJoinedMas)}),appEth.use(cors(corsOptions)),appEth.use((a,e)=>{e.json(ethJoinedMas)}),appLtc.use(cors(corsOptions)),appLtc.use((a,e)=>{e.json(ltcJoinedMas)}),randCount.use(cors(corsOptions)),randCount.use((a,e)=>{e.json(randPar)}),appTable.listen(3002,()=>{console.log("Server 'Main Page' has been started...")}),appAll.listen(all,()=>{console.log("Server 'All Currencies' has been started...")}),appDataCoins.listen(3006,()=>{console.log("Server 'Data Coins' has been started...")}),appBtc.listen(btc,()=>{console.log("Server 'BTC Data' has been started...")}),appEth.listen(eth,()=>{console.log("Server 'ETH Data' has been started...")}),appLtc.listen(ltc,()=>{console.log("Server 'LTC Data' has been started...")}),randCount.listen(3016,()=>{console.log("Server 'Random' has been started...")}),godexData(),allDataGet(),tableDataGet(),btcDataGet(),ethDataGet(),ltcDataGet(),coinsDataGet(),randFunc(),setInterval(()=>{allDataGet(),btcDataGet(),ethDataGet(),ltcDataGet(),coinsDataGet()},216e5),setInterval(()=>{tableDataGet()},36e5),setInterval(()=>{0==(new Date).getHours()&&randFunc()},6e4);